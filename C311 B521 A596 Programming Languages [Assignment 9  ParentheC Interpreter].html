<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0059)https://cgi.soic.indiana.edu/~c311/doku.php?id=assignment-9 -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="google-site-verification" content="CHpL8-yKEGFx7Gy37uNcU2lz9oRZydQdifkiJNj6-P4">
  
  <title>
    C311/B521/A596 Programming Languages    [Assignment 9: ParentheC Interpreter]
  </title>

  <meta name="generator" content="DokuWiki Release 2009-02-14b">
<meta name="robots" content="noindex,nofollow">
<meta name="date" content="2014-10-24T12:38:20-0400">
<meta name="keywords" content="assignment-9">
<link rel="search" type="application/opensearchdescription+xml" href="https://cgi.soic.indiana.edu/~c311/lib/exe/opensearch.php" title="C311/B521/A596 Programming Languages">
<link rel="start" href="https://cgi.soic.indiana.edu/~c311/">
<link rel="alternate" type="application/rss+xml" title="Recent Changes" href="https://cgi.soic.indiana.edu/~c311/feed.php">
<link rel="alternate" type="application/rss+xml" title="Current Namespace" href="https://cgi.soic.indiana.edu/~c311/feed.php?mode=list&ns=">
<link rel="alternate" type="text/html" title="Plain HTML" href="https://cgi.soic.indiana.edu/~c311/doku.php?do=export_xhtml&id=assignment-9">
<link rel="stylesheet" media="all" type="text/css" href="./C311 B521 A596 Programming Languages [Assignment 9  ParentheC Interpreter]_files/css.php">
<link rel="stylesheet" media="screen" type="text/css" href="./C311 B521 A596 Programming Languages [Assignment 9  ParentheC Interpreter]_files/css(1).php">
<link rel="stylesheet" media="print" type="text/css" href="./C311 B521 A596 Programming Languages [Assignment 9  ParentheC Interpreter]_files/css(2).php">
<script type="text/javascript" charset="utf-8" src="./C311 B521 A596 Programming Languages [Assignment 9  ParentheC Interpreter]_files/js.php"></script>

  <link rel="shortcut icon" href="https://cgi.soic.indiana.edu/~c311/lib/tpl/doogiestpl/images/favicon.ico">

  <style type="text/css"></style></head>



<body>
<div class="dokuwiki">
  
  <div class="stylehead">

    <div class="header">
      <div class="header_left"></div>
      <div class="logo">
        <a href="https://cgi.soic.indiana.edu/~c311/doku.php" name="dokuwiki__top" id="dokuwiki__top" accesskey="h" title="[ALT+H]">C311/B521/A596 Programming Languages</a>      </div>

      <div id="tabnavi" class="tabnavi">
	    <ul>
<li><a href="https://cgi.soic.indiana.edu/~c311/doku.php?id=home">Home</a></li>
<li><a href="https://cgi.soic.indiana.edu/~c311/doku.php?id=course-policies">Policies</a></li>
<li><a href="https://cgi.soic.indiana.edu/~c311/doku.php?id=instructors">Instructors</a></li>
<li><a href="https://cgi.soic.indiana.edu/~c311/doku.php?id=resources">Resources</a></li>
<li><a href="https://cgi.soic.indiana.edu/~c311/doku.php?id=schedule">Schedule</a></li>
<li><a href="https://cgi.soic.indiana.edu/~c311/doku.php?id=assignments">Assignments</a></li>
<li><a href="https://cgi.soic.indiana.edu/~c311/doku.php?id=b621">B621</a></li>
</ul>
	  </div>
	  
	  <div class="clearer"></div>
      	</div>  
  </div>
    
  
   <div style="float: right;">
            <form class="button btn_login" method="get" action="https://cgi.soic.indiana.edu/~c311/doku.php"><div class="no"><input type="hidden" name="do" value="login"><input type="hidden" name="sectok" value="b0ed4e098430fec5dcf5228951d507ea"><input type="hidden" name="id" value="assignment-9"><input type="submit" value="Login" class="button" title="Login"></div></form>       &nbsp;  &nbsp;  &nbsp;
   </div>
  <div class="clearer">&nbsp;</div>


  <div class="page">
    <!-- ......... wikipage start ......... -->
    


<h1><a name="assignment-9parenthec-interpreter" id="assignment-9parenthec-interpreter">Assignment 9: ParentheC Interpreter</a></h1>
<div class="level1">

<blockquote cite="./C311 B521 A596 Programming Languages [Assignment 9  ParentheC Interpreter]_files/Richard Pattis" class="blockquote-plugin">
<p>
“Code should run as fast as necessary, but no faster; something important is always traded away to increase speed.”

</p>

</blockquote>

</div>

<h2><a name="introduction" id="introduction">Introduction</a></h2>
<div class="level2">

<p>

Your task is to transform the interpreter below into a language that can be automatically converted to C. We will be using ParentheC for this task, so you'll be CPSing and registerizing the interpreter below before making final modifications to make it ready for ParentheC. 
</p>

<p>
<strong>You cannot receive a grade for this course until you complete this assignment and demonstrate your understanding with one of the instructors. See the end of this page for more details.</strong>
</p>

</div>

<h2><a name="preliminaries" id="preliminaries">Preliminaries</a></h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> If you haven't done so, you should probably read <a href="https://cgi.soic.indiana.edu/~c311/lib/exe/fetch.php?media=parenthec.pdf" class="media mediafile mf_pdf" title="parenthec.pdf">the ParentheC paper</a>, <em>Using ParentheC to Transform Scheme Programs to C or How to Write Interesting Recursive Programs in a Spartan Host (Program Counter)</em>. It is slightly out of date viz. registerization, but can still prove a useful resource.</div>
</li>
<li class="level1"><div class="li"> Download <a href="https://cgi.soic.indiana.edu/~c311/lib/exe/fetch.php?media=parenthec.rkt" class="media mediafile mf_rkt" title="parenthec.rkt">parenthec.rkt</a> and <a href="https://cgi.soic.indiana.edu/~c311/lib/exe/fetch.php?media=pc2c.rkt" class="media mediafile mf_rkt" title="pc2c.rkt">pc2c.rkt</a> </div>
</li>
</ul>

<p>

<!---
{{:pc2j.ss|pc2j.ss}}.
--->
</p>

</div>

<h2><a name="language" id="language">Language</a></h2>
<div class="level2">

<p>

The language we will be using for the interpreter in the assignment is characterized by the grammar here:
</p>
<pre class="code lisp">          <span class="sy0">&lt;</span>expr<span class="sy0">&gt;</span>   ::<span class="sy0">=</span>  <span class="br0">(</span>exp_const <span class="sy0">&lt;</span>integer<span class="sy0">&gt;</span><span class="br0">)</span>
                    |   <span class="br0">(</span>exp_var <span class="sy0">&lt;</span>integer<span class="sy0">&gt;</span><span class="br0">)</span>
                    |   <span class="br0">(</span>exp_if <span class="sy0">&lt;</span>expr<span class="sy0">&gt;</span> <span class="sy0">&lt;</span>expr<span class="sy0">&gt;</span> <span class="sy0">&lt;</span>expr<span class="sy0">&gt;</span><span class="br0">)</span>
                    |   <span class="br0">(</span>exp_mult <span class="sy0">&lt;</span>expr<span class="sy0">&gt;</span> <span class="sy0">&lt;</span>expr<span class="sy0">&gt;</span><span class="br0">)</span>
                    |   <span class="br0">(</span>exp_sub1 <span class="sy0">&lt;</span>expr<span class="sy0">&gt;</span><span class="br0">)</span>
                    |   <span class="br0">(</span>exp_zero <span class="sy0">&lt;</span>expr<span class="sy0">&gt;</span><span class="br0">)</span>
                    |   <span class="br0">(</span>exp_capture <span class="sy0">&lt;</span>expr<span class="sy0">&gt;</span><span class="br0">)</span>
                    |   <span class="br0">(</span>exp_return <span class="sy0">&lt;</span>expr<span class="sy0">&gt;</span> <span class="sy0">&lt;</span>expr<span class="sy0">&gt;</span><span class="br0">)</span>
                    |   <span class="br0">(</span>exp_let <span class="sy0">&lt;</span>expr<span class="sy0">&gt;</span> <span class="sy0">&lt;</span>expr<span class="sy0">&gt;</span><span class="br0">)</span>              
                    |   <span class="br0">(</span>exp_lambda <span class="sy0">&lt;</span>expr<span class="sy0">&gt;</span><span class="br0">)</span>
                    |   <span class="br0">(</span>exp_app <span class="sy0">&lt;</span>expr<span class="sy0">&gt;</span> <span class="sy0">&lt;</span>expr<span class="sy0">&gt;</span><span class="br0">)</span></pre>
<p>
This is quite simple, and identical to the other languages that we have written interpreters for. However, we now explicitly tag all language constructs. When we refer to a variable (using <code>exp_var</code>) we refer to the variable's lexical address.
</p>

<p>
We provide a <a href="https://cgi.soic.indiana.edu/~c311/lib/exe/fetch.php?media=parse.rkt" class="media mediafile mf_rkt" title="parse.rkt">parse.rkt</a> file, which contains a function <code>parse</code> that will convert normal Scheme-like syntax into the language we are using on this assignment. For example,
</p>
<pre class="code lisp"><span class="sy0">&gt;</span> <span class="br0">(</span>require <span class="st0">"parse.rkt"</span><span class="br0">)</span>
<span class="sy0">&gt;</span> <span class="br0">(</span>parse '<span class="br0">(</span><span class="br0">(</span><span class="kw1">lambda</span> <span class="br0">(</span>a b c<span class="br0">)</span> <span class="br0">(</span><span class="sy0">*</span> a c<span class="br0">)</span><span class="br0">)</span> <span class="nu0">5</span> <span class="nu0">6</span> <span class="nu0">7</span><span class="br0">)</span><span class="br0">)</span>
&nbsp;
          <span class="br0">(</span>exp_app
            <span class="br0">(</span>exp_app
              <span class="br0">(</span>exp_app
                <span class="br0">(</span>exp_lambda
                  <span class="br0">(</span>exp_lambda
                    <span class="br0">(</span>exp_lambda <span class="br0">(</span>exp_mult <span class="br0">(</span>exp_var <span class="nu0">2</span><span class="br0">)</span> <span class="br0">(</span>exp_var 0<span class="br0">)</span><span class="br0">)</span><span class="br0">)</span><span class="br0">)</span><span class="br0">)</span>
                <span class="br0">(</span>exp_const <span class="nu0">5</span><span class="br0">)</span><span class="br0">)</span>
              <span class="br0">(</span>exp_const <span class="nu0">6</span><span class="br0">)</span><span class="br0">)</span>
            <span class="br0">(</span>exp_const <span class="nu0">7</span><span class="br0">)</span><span class="br0">)</span></pre>
<p>
Use this to generate tests for your program. Notice that the output is curried for you. Note also that our parser produces quoted output, but your <code>value-of</code> will not take quoted expressions as input. 
</p>

<p>
Here is a fully-functioning interpreter that implements this language for us. It uses the ParentheC <em>union</em> type to represent the language.
</p>
<pre class="code lisp">#lang racket
<span class="br0">(</span>require <span class="st0">"parenthec.rkt"</span><span class="br0">)</span>
&nbsp;
<span class="br0">(</span>define<span class="sy0">-</span>union <span class="kw1">exp</span>
  <span class="br0">(</span>const n<span class="br0">)</span>
  <span class="br0">(</span>var v<span class="br0">)</span>
  <span class="br0">(</span><span class="kw1">if</span> test conseq alt<span class="br0">)</span>
  <span class="br0">(</span>mult rand1 rand2<span class="br0">)</span>
  <span class="br0">(</span>sub1 rand<span class="br0">)</span>
  <span class="br0">(</span>zero rand<span class="br0">)</span>
  <span class="br0">(</span>capture body<span class="br0">)</span>
  <span class="br0">(</span><span class="kw1">return</span> vexp kexp<span class="br0">)</span>
  <span class="br0">(</span><span class="kw1">let</span> vexp body<span class="br0">)</span>
  <span class="br0">(</span><span class="kw1">lambda</span> body<span class="br0">)</span>
  <span class="br0">(</span>app rator rand<span class="br0">)</span><span class="br0">)</span>
&nbsp;
<span class="br0">(</span>define value<span class="sy0">-</span>of
  <span class="br0">(</span><span class="kw1">lambda</span> <span class="br0">(</span>expr env<span class="br0">)</span>
    <span class="br0">(</span>union<span class="sy0">-</span><span class="kw1">case</span> expr <span class="kw1">exp</span>
      <span class="br0">[</span><span class="br0">(</span>const n<span class="br0">)</span> n<span class="br0">]</span>
      <span class="br0">[</span><span class="br0">(</span>var v<span class="br0">)</span> <span class="br0">(</span>apply<span class="sy0">-</span>env env v<span class="br0">)</span><span class="br0">]</span>
      <span class="br0">[</span><span class="br0">(</span><span class="kw1">if</span> test conseq alt<span class="br0">)</span>
       <span class="br0">(</span><span class="kw1">if</span> <span class="br0">(</span>value<span class="sy0">-</span>of test env<span class="br0">)</span>
	   <span class="br0">(</span>value<span class="sy0">-</span>of conseq env<span class="br0">)</span>
	   <span class="br0">(</span>value<span class="sy0">-</span>of alt env<span class="br0">)</span><span class="br0">)</span><span class="br0">]</span>
      <span class="br0">[</span><span class="br0">(</span>mult rand1 rand2<span class="br0">)</span> <span class="br0">(</span><span class="sy0">*</span> <span class="br0">(</span>value<span class="sy0">-</span>of rand1 env<span class="br0">)</span> <span class="br0">(</span>value<span class="sy0">-</span>of rand2 env<span class="br0">)</span><span class="br0">)</span><span class="br0">]</span>
      <span class="br0">[</span><span class="br0">(</span>sub1 rand<span class="br0">)</span> <span class="br0">(</span><span class="sy0">-</span> <span class="br0">(</span>value<span class="sy0">-</span>of rand env<span class="br0">)</span> <span class="nu0">1</span><span class="br0">)</span><span class="br0">]</span>
      <span class="br0">[</span><span class="br0">(</span>zero rand<span class="br0">)</span> <span class="br0">(</span>zero? <span class="br0">(</span>value<span class="sy0">-</span>of rand env<span class="br0">)</span><span class="br0">)</span><span class="br0">]</span>
      <span class="br0">[</span><span class="br0">(</span>capture body<span class="br0">)</span>
       <span class="br0">(</span>call<span class="sy0">/</span>cc
	<span class="br0">(</span><span class="kw1">lambda</span> <span class="br0">(</span>k<span class="br0">)</span>
	  <span class="br0">(</span>value<span class="sy0">-</span>of body <span class="br0">(</span>envr_extend k env<span class="br0">)</span><span class="br0">)</span><span class="br0">)</span><span class="br0">)</span><span class="br0">]</span>
      <span class="br0">[</span><span class="br0">(</span><span class="kw1">return</span> vexp kexp<span class="br0">)</span>
       <span class="br0">(</span><span class="br0">(</span>value<span class="sy0">-</span>of kexp env<span class="br0">)</span> <span class="br0">(</span>value<span class="sy0">-</span>of vexp env<span class="br0">)</span><span class="br0">)</span><span class="br0">]</span>
      <span class="br0">[</span><span class="br0">(</span><span class="kw1">let</span> vexp body<span class="br0">)</span>
       <span class="br0">(</span><span class="kw1">let</span> <span class="br0">(</span><span class="br0">(</span>v <span class="br0">(</span>value<span class="sy0">-</span>of vexp env<span class="br0">)</span><span class="br0">)</span><span class="br0">)</span>
         <span class="br0">(</span>value<span class="sy0">-</span>of body <span class="br0">(</span>envr_extend v env<span class="br0">)</span><span class="br0">)</span><span class="br0">)</span><span class="br0">]</span>
      <span class="br0">[</span><span class="br0">(</span><span class="kw1">lambda</span> body<span class="br0">)</span> <span class="br0">(</span>clos_closure body env<span class="br0">)</span><span class="br0">]</span>
      <span class="br0">[</span><span class="br0">(</span>app rator rand<span class="br0">)</span>
       <span class="br0">(</span>apply<span class="sy0">-</span>closure <span class="br0">(</span>value<span class="sy0">-</span>of rator env<span class="br0">)</span> <span class="br0">(</span>value<span class="sy0">-</span>of rand env<span class="br0">)</span><span class="br0">)</span><span class="br0">]</span><span class="br0">)</span><span class="br0">)</span><span class="br0">)</span>
&nbsp;
<span class="br0">(</span>define<span class="sy0">-</span>union envr
  <span class="br0">(</span>empty<span class="br0">)</span>
  <span class="br0">(</span>extend arg env<span class="br0">)</span><span class="br0">)</span>
&nbsp;
<span class="br0">(</span>define apply<span class="sy0">-</span>env
  <span class="br0">(</span><span class="kw1">lambda</span> <span class="br0">(</span>env num<span class="br0">)</span>
    <span class="br0">(</span>union<span class="sy0">-</span><span class="kw1">case</span> env envr
      <span class="br0">[</span><span class="br0">(</span>empty<span class="br0">)</span> <span class="br0">(</span><span class="kw1">error</span> 'env <span class="st0">"unbound variable"</span><span class="br0">)</span><span class="br0">]</span>
      <span class="br0">[</span><span class="br0">(</span>extend arg env<span class="br0">)</span>
       <span class="br0">(</span><span class="kw1">if</span> <span class="br0">(</span>zero? num<span class="br0">)</span>
	   arg
	   <span class="br0">(</span>apply<span class="sy0">-</span>env env <span class="br0">(</span>sub1 num<span class="br0">)</span><span class="br0">)</span><span class="br0">)</span><span class="br0">]</span><span class="br0">)</span><span class="br0">)</span><span class="br0">)</span>
&nbsp;
<span class="br0">(</span>define<span class="sy0">-</span>union clos
  <span class="br0">(</span>closure code env<span class="br0">)</span><span class="br0">)</span>
&nbsp;
<span class="br0">(</span>define apply<span class="sy0">-</span>closure
  <span class="br0">(</span><span class="kw1">lambda</span> <span class="br0">(</span>c a<span class="br0">)</span>
    <span class="br0">(</span>union<span class="sy0">-</span><span class="kw1">case</span> c clos
      <span class="br0">[</span><span class="br0">(</span>closure code env<span class="br0">)</span>
       <span class="br0">(</span>value<span class="sy0">-</span>of code <span class="br0">(</span>envr_extend a env<span class="br0">)</span><span class="br0">)</span><span class="br0">]</span><span class="br0">)</span><span class="br0">)</span><span class="br0">)</span>
&nbsp;
                                        <span class="co1">; Basic test...should be 5.</span>
<span class="br0">(</span>pretty<span class="sy0">-</span>print
 <span class="br0">(</span>value<span class="sy0">-</span>of <span class="br0">(</span>exp_app
            <span class="br0">(</span>exp_app
             <span class="br0">(</span>exp_lambda <span class="br0">(</span>exp_lambda <span class="br0">(</span>exp_var <span class="nu0">1</span><span class="br0">)</span><span class="br0">)</span><span class="br0">)</span>
             <span class="br0">(</span>exp_const <span class="nu0">5</span><span class="br0">)</span><span class="br0">)</span>
            <span class="br0">(</span>exp_const <span class="nu0">6</span><span class="br0">)</span><span class="br0">)</span>
           <span class="br0">(</span>envr_empty<span class="br0">)</span><span class="br0">)</span><span class="br0">)</span>
&nbsp;
					<span class="co1">; Factorial of 5...should be 120.</span>
<span class="br0">(</span>pretty<span class="sy0">-</span>print
 <span class="br0">(</span>value<span class="sy0">-</span>of <span class="br0">(</span>exp_app
	    <span class="br0">(</span>exp_lambda
	     <span class="br0">(</span>exp_app
	      <span class="br0">(</span>exp_app <span class="br0">(</span>exp_var 0<span class="br0">)</span> <span class="br0">(</span>exp_var 0<span class="br0">)</span><span class="br0">)</span>
	      <span class="br0">(</span>exp_const <span class="nu0">5</span><span class="br0">)</span><span class="br0">)</span><span class="br0">)</span>
	    <span class="br0">(</span>exp_lambda
	     <span class="br0">(</span>exp_lambda
	      <span class="br0">(</span>exp_if <span class="br0">(</span>exp_zero <span class="br0">(</span>exp_var 0<span class="br0">)</span><span class="br0">)</span>
		      <span class="br0">(</span>exp_const <span class="nu0">1</span><span class="br0">)</span>
		      <span class="br0">(</span>exp_mult <span class="br0">(</span>exp_var 0<span class="br0">)</span>
				<span class="br0">(</span>exp_app
				 <span class="br0">(</span>exp_app <span class="br0">(</span>exp_var <span class="nu0">1</span><span class="br0">)</span> <span class="br0">(</span>exp_var <span class="nu0">1</span><span class="br0">)</span><span class="br0">)</span>
				 <span class="br0">(</span>exp_sub1 <span class="br0">(</span>exp_var 0<span class="br0">)</span><span class="br0">)</span><span class="br0">)</span><span class="br0">)</span><span class="br0">)</span><span class="br0">)</span><span class="br0">)</span><span class="br0">)</span>
	   <span class="br0">(</span>envr_empty<span class="br0">)</span><span class="br0">)</span><span class="br0">)</span>
&nbsp;
					<span class="co1">; Test of capture and return...should evaluate to 24.</span>
<span class="br0">(</span>pretty<span class="sy0">-</span>print
 <span class="br0">(</span>value<span class="sy0">-</span>of
  <span class="br0">(</span>exp_mult <span class="br0">(</span>exp_const <span class="nu0">2</span><span class="br0">)</span>
	    <span class="br0">(</span>exp_capture
	     <span class="br0">(</span>exp_mult <span class="br0">(</span>exp_const <span class="nu0">5</span><span class="br0">)</span>
		       <span class="br0">(</span>exp_return <span class="br0">(</span>exp_mult <span class="br0">(</span>exp_const <span class="nu0">2</span><span class="br0">)</span> <span class="br0">(</span>exp_const <span class="nu0">6</span><span class="br0">)</span><span class="br0">)</span>
                                   <span class="br0">(</span>exp_var 0<span class="br0">)</span><span class="br0">)</span><span class="br0">)</span><span class="br0">)</span><span class="br0">)</span>
  <span class="br0">(</span>envr_empty<span class="br0">)</span><span class="br0">)</span><span class="br0">)</span> 
&nbsp;
<span class="co1">;; (let ([fact (lambda (f)                                                      </span>
<span class="co1">;;               (lambda (n)                                                    </span>
<span class="co1">;;                 (if (zero? n)                                                </span>
<span class="co1">;;                     1                                                        </span>
<span class="co1">;;                     (* n ((f f) (sub1 n))))))])                              </span>
<span class="co1">;;   ((fact fact) 5))                                                           </span>
&nbsp;
<span class="br0">(</span>pretty<span class="sy0">-</span>print
 <span class="br0">(</span>value<span class="sy0">-</span>of <span class="br0">(</span>exp_let
	    <span class="br0">(</span>exp_lambda
	     <span class="br0">(</span>exp_lambda
	      <span class="br0">(</span>exp_if
	       <span class="br0">(</span>exp_zero <span class="br0">(</span>exp_var 0<span class="br0">)</span><span class="br0">)</span>
	       <span class="br0">(</span>exp_const <span class="nu0">1</span><span class="br0">)</span>
	       <span class="br0">(</span>exp_mult
		<span class="br0">(</span>exp_var 0<span class="br0">)</span>
		<span class="br0">(</span>exp_app
		 <span class="br0">(</span>exp_app <span class="br0">(</span>exp_var <span class="nu0">1</span><span class="br0">)</span> <span class="br0">(</span>exp_var <span class="nu0">1</span><span class="br0">)</span><span class="br0">)</span>
		 <span class="br0">(</span>exp_sub1 <span class="br0">(</span>exp_var 0<span class="br0">)</span><span class="br0">)</span><span class="br0">)</span><span class="br0">)</span><span class="br0">)</span><span class="br0">)</span><span class="br0">)</span>
	    <span class="br0">(</span>exp_app <span class="br0">(</span>exp_app <span class="br0">(</span>exp_var 0<span class="br0">)</span> <span class="br0">(</span>exp_var 0<span class="br0">)</span><span class="br0">)</span> <span class="br0">(</span>exp_const <span class="nu0">5</span><span class="br0">)</span><span class="br0">)</span><span class="br0">)</span>
	   <span class="br0">(</span>envr_empty<span class="br0">)</span><span class="br0">)</span><span class="br0">)</span></pre>
<p>
Note that the programs we pass to <code>value-of</code> do not have a quote in front of them. Why is this? Because the programs are no longer lists. We are actually passing a series of nested unions created by calling these tagged constructors.
</p>

<p>
<strong>Note</strong>: ParentheC does not support the <code>pretty-print</code> command, so you will need to <code>printf</code> akin to <code>(printf ”~s\n” *v)</code> in your main function to display the results of the execution. Notice we use <code>\n</code> is used as the newline character. 
</p>

</div>

<h2><a name="assignment" id="assignment">Assignment</a></h2>
<div class="level2">

<p>

Your assignment is to turn this interpreter into C programs using ParentheC, and run the <code>factorial</code> and <code>capture</code> test programs. Here are the steps you will need to accomplish. Save a new copy of your interpreter after you finish every step. <strong>We will expect you to have all of these intermediate files available during your demonstration</strong>. Also, you will often need to go back to an older version of your interpreter and having copies of all of them will save a lot of time.

</p>
<ol>
<li class="level1"><div class="li"> CPS this interpreter. It will be easier if you treat <code>apply-env</code> and <code>apply-closure</code> as serious, <code>closure</code> and <code>extend</code> as simple. </div>
</li>
<li class="level1"><div class="li"> Make the interpreter representation-independent with respect to continuations (using functional reps). </div>
</li>
<li class="level1"><div class="li"> Make your continuations be data structures (tagged lists).</div>
</li>
<li class="level1"><div class="li"> Make your continuations be ParentheC unions (remove the old ds constructors), and change uses of pmatch to uses of union-case.</div>
</li>
<li class="level1"><div class="li"> Write your interpreter using our A-normal form style, by adding <code>let*</code> above your serious calls.</div>
</li>
<li class="level1"><div class="li"> Registerize the interpreter.</div>
</li>
<li class="level1"><div class="li"> Add a function <code>main</code> (of no arguments, whose body is a single <code>(begin …)</code>) block (no nested begins) that does whatever computations your program needs to accomplish. </div>
</li>
<li class="level1"><div class="li"> Change all of your <code>(define name (lambda () …))</code> statements to use <code>define-label</code>.</div>
</li>
<li class="level1"><div class="li"> Define your registers and program counter at the top of the program.</div>
</li>
<li class="level1"><div class="li"> Convert non-simple tail calls to assignments to the program counter, and then add calls to <code>mount-trampoline</code> and <code>dismount-trampoline</code>.</div>
</li>
<li class="level1"><div class="li"> Verify that everything works in Scheme.</div>
</li>
<li class="level1"><div class="li"> In a <strong>fresh</strong> Scheme process with <strong>no</strong> other files loaded, load <code>pc2c.rkt</code>, generate C code for your interpreter, compile the C program, and run the resulting executable, verifying that you see the correct output.  (If you don't know how to do this step, check with the AIs for help.)</div>
</li>
</ol>

<p>

<!---
  - In a **fresh** Scheme process with **no** other files loaded, load &#039;&#039;pc2j.ss&#039;&#039;, generate Java code for your interpreter, compile the Java program, and run the resulting executable, verifying that you see the correct output. For instructions on using &#039;&#039;pc2j&#039;&#039;, see the comments at the top of the file.
--->
</p>

<p>
Save a new copy of your interpreter after you finish every step. <strong>We will expect you to have all of these intermediate files available during your demonstration</strong>. Also, you will often need to go back to an older version of your interpreter and having copies of all of them will save a lot of time.

</p>
<ul>
<li class="level1"><div class="li"> You should turn in a file named <code>interp.pc</code> that contains the exact Scheme code you used to generate your C programs.</div>
</li>
<li class="level1"><div class="li"> This assignment is due on <strong>Wednesday, November 5th at 11:59 p.m.</strong> Once you've done the assignment, you must meet with one of the <a href="https://cgi.soic.indiana.edu/~c311/doku.php?id=instructors" class="wikilink1" title="instructors">AIs</a> to demonstrate your knowledge of your code.  This meeting is a required part of the assignment and must take place on or before <strong>Friday, November 14th</strong>.</div>
</li>
<li class="level1"><div class="li"> You must book an appt in advance (at least 1 day in advance). Make sure you get an email confirming your appointment. </div>
</li>
</ul>
<p><span style="display:none"><a href="https://www.schedulething.com/">Online Scheduling System powered by ScheduleThing</a></span><a id="showSTWidget" onclick="document.getElementById(&#39;STIframeWrap&#39;).style.display=&#39;block&#39;; document.getElementById(&#39;SToverlay&#39;).style.display=&#39;block&#39;; return false;" href="https://cgi.soic.indiana.edu/~c311/doku.php?id=assignment-9#"><img src="./C311 B521 A596 Programming Languages [Assignment 9  ParentheC Interpreter]_files/widgetButton.png" border="0"></a></p><script type="text/javascript" id="STScript">
  var STTag = document.createElement("script");
  var protocol = "https:" == document.location.protocol ? "https://" : "http://";
  STTag.src = protocol + "a9.schedulething.com/index/widget?widgetLocation=" + document.location.href.replace(/\?/gi, '%3F').replace(/\&/gi, '%26');
  var s = document.getElementById("STScript"); s.parentNode.appendChild(STTag);
</script><script src="./C311 B521 A596 Programming Languages [Assignment 9  ParentheC Interpreter]_files/widget"></script><ul>
<li class="level1"><div class="li"> Remember: successful completion of this assignment and code review is required in order to receive a grade for this course. For assignments handed in after the due date, credit is reduced proportionally to lateness.</div>
</li>
</ul>

</div>

<h2><a name="just-dessert" id="just-dessert">Just Dessert</a></h2>
<div class="level2">

<p>

Add a <code>callcc</code> form to your interpreter that behaves like Scheme's <code>call/cc</code>. Include at least one test program, as well as any necessary changes to the parser or other files in an email to your instructor.

</p>

</div>

    <!-- ......... wikipage stop  ......... -->
  </div>

  <div class="clearer">&nbsp;</div>

  
 
  <!--  footer -->  
  <div class="stylefoot">

        <div class="meta">
      <div class="doc">
		<p>assignment-9.txt · Last modified: 2014/10/24 12:38 by jhemann</p>
      </div>
   </div>

    <div>
       <!--  breadcrumbs and search -->
	  	
	  

       
      <div class="clearer"></div>
    </div>

  </div>

</div>





<div class="no"><img src="./C311 B521 A596 Programming Languages [Assignment 9  ParentheC Interpreter]_files/indexer.php" width="1" height="1" alt=""></div>


<div><div id="STIframeWrap" style="display:none;position:fixed;top:0;left:0;width:100%;z-index:10001;"><div id="STContainer" style="height:400px;width:480px;margin:20px auto 0 auto;position:relative;z-index:10002;border: 10px solid #999;"><a onclick="document.getElementById(&#39;STIframeWrap&#39;).style.display=&#39;none&#39;; document.getElementById(&#39;SToverlay&#39;).style.display=&#39;none&#39;;document.getElementById(&#39;STIframe&#39;).src=&#39;https://a9.schedulething.com?is-widget=true&amp;widgetLocation=https%3A%2F%2Fcgi.soic.indiana.edu%2F%7Ec311%2Fdoku.php%3Fid%3Dassignment-9&#39;; return false;" href="https://cgi.soic.indiana.edu/~c311/doku.php?id=assignment-9#" style="float:right;position:absolute;top:-20px;right:-20px;z-index:10003" id="hideSTWidget"><img src="./C311 B521 A596 Programming Languages [Assignment 9  ParentheC Interpreter]_files/close-widget.png" style="border:0;" height="30" width="30"></a><iframe id="STIframe" src="./C311 B521 A596 Programming Languages [Assignment 9  ParentheC Interpreter]_files/saved_resource.html" style="width:100%;height:400px;overflow-x: hidden;overflow-y:auto;border:none;" frameborder="0"></iframe></div></div></div><div><div id="SToverlay" style="display:none;background:#000;opacity:0.5;width:100%;height:100%; z-index:10000;position:fixed;top:0;left:0;filter:Alpha(Opacity=50)"></div></div></body></html>